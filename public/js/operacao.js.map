{"version":3,"file":"operacao.js","sources":["../../app/js/operacao.js"],"names":["initOperacoes","Modernizr","touch","$","attr","datepicker","dateFormat","dayNames","dayNamesMin","dayNamesShort","monthNames","monthNamesShort","nextText","prevText","minDate","afterShow","input","inst","td","dpDiv","css","width","getJSON","data","dynatable","writers","date","record","parsedDate","moment","format","status","parsedStatus","delete","id","inputs","recordCountPageBoundTemplate","recordCountPageUnboundedTemplate","recordCountTotalTemplate","recordCountFilteredTemplate","recordCountTextTemplate","perPageText","processingText","paginationPrev","paginationNext","recordCountText","features","paginate","dataset","records","operations","fail","on","e","deleteOp","currentTarget","click","dateValue","dateArray","operation","val","split","Date","getTime","desc","addOperation","buttonTag","r","confirm","type","ajax","cache","url","dataType","JSON","stringify","success","callback","sweetAlert","error","console","log","configTimeout","preventDefault","saveOperations","settings","originalRecords","push","process","unblockUI","document","ready","window","location","href","indexOf"],"mappings":"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","sourcesContent":["var initOperacoes = function() {\n\n  if (!Modernizr.touch) {\n    $(\"#opDate\").attr('type', 'text').datepicker({\n      dateFormat: 'dd/mm/yy',\n      dayNames: ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'],\n      dayNamesMin: ['D', 'S', 'T', 'Q', 'Q', 'S', 'S', 'D'],\n      dayNamesShort: ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'],\n      monthNames: ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'],\n      monthNamesShort: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],\n      nextText: 'Próximo',\n      prevText: 'Anterior',\n      minDate: 0,\n      afterShow: function(input, inst, td) {\n        inst.dpDiv.css('width', '400px');\n        $(\".ui-datepicker\").css('width', $(\"#opDate\").width());\n      }\n    });\n    //$(\".ui-datepicker\").css('width', $(\"#opDate\").width());\n  }\n\n  $.getJSON(\"https://surerussolutions.com/divegold-webservice/operation\", function(data) {\n\n    $('#opTable').dynatable({\n      writers: {\n        'date': function(record) {\n          record.parsedDate = record.date;\n          return moment(record.date).format('DD/MM/YYYY');\n        },\n        'status': function(record) {\n          record.parsedStatus = record.status;\n          return (record.status) ? \"Confirmada\" : \"Em aberto\";\n        },\n        'delete': function(record) {\n          return \"<button data-id='\" + record.id + \"' class='btn btn-danger btn-xs btn-raised btnRemoveOp'><span class='mdi-content-clear'></span></button>\";\n        }\n      },\n      inputs: {\n        recordCountPageBoundTemplate: '{pageLowerBound} a {pageUpperBound} de',\n        recordCountPageUnboundedTemplate: '{recordsShown} de',\n        recordCountTotalTemplate: '{recordsQueryCount} {collectionName}',\n        recordCountFilteredTemplate: ' (filtrado {recordsTotal} operações)',\n        recordCountTextTemplate: '{text} {pageTemplate} {totalTemplate} {filteredTemplate}',\n        perPageText: 'Mostrar: ',\n        processingText: 'Processando...',\n        paginationPrev: 'Anterior',\n        paginationNext: 'Próximo',\n        recordCountText: 'Exibindo '\n      },\n      features: {\n        paginate: true\n      },\n      dataset: {\n        records: data.operations\n      }\n    });\n  }).fail(function() {\n\n  });\n\n  $(\".tableContainer\").on(\"click\", \"button\", function(e) {\n    deleteOp(e.currentTarget);\n  });\n\n  $(\"#btnAdicionarOp\").click(function() {\n    var operation = {},\n      dateValue,\n      dateArray;\n\n    dateValue = $(\"#opDate\").val();\n    dateArray = dateValue.split(\"/\");\n    dateValue = dateArray[1] + '-' + dateArray[0] + '-' + dateArray[2];\n    operation.date = new Date(dateValue).getTime();\n\n    operation.desc = $(\"#opName\").val();\n\n    addOperation(operation);\n\n    $(\"#opDate\").val(\"\");\n    $(\"#opName\").val(\"\");\n  });\n\n};\n\nvar deleteOp = function(buttonTag) {\n  var r = confirm(\"Tem certeza que deseja remover esta operação?\");\n  if (r === true) {\n    var operation = {};\n\n    operation.id = $(buttonTag).data(\"id\");\n    operation.type = {};\n    operation.type.id = 1;\n    operation.type.desc = \"Livre - Mina da Passagem\";\n    operation.desc = \"TESTE-DELETE\";\n    operation.date = new Date().getTime();\n    operation.status = 0;\n\n    $.ajax({\n      cache: false,\n      url: \"//surerussolutions.com/divegold-webservice/operation/delete\",\n      type: \"POST\",\n      dataType: \"json\",\n      data: JSON.stringify(operation),\n      success: function(callback) {\n        sweetAlert('Operação removida com sucesso!', '', 'success');\n      },\n      error: function(e) {\n        console.log(e);\n        configTimeout(\"Ocorreu um erro ao tentar excluir esta operação.\");\n      }\n    });\n  } else {\n    e.preventDefault();\n  }\n};\n\nvar addOperation = function(operation) {\n  if (!operation) {\n    configTimeout(\"Os campos de data e nome da operação são obrigatórios.\");\n    return;\n  }\n\n  saveOperations(operation);\n};\n\nvar saveOperations = function(data) {\n  var dynatable = $('#opTable').data('dynatable'),\n    tableOperations = dynatable.settings.dataset.originalRecords;\n\n  var operation = {};\n\n  operation.id = 0;\n  operation.type = {};\n  operation.type.id = 1;\n  operation.type.desc = \"Livre - Mina da Passagem\";\n  operation.desc = data.desc;\n  operation.date = data.date;\n  operation.status = 0;\n\n  console.log(JSON.stringify(operation));\n\n  $.ajax({\n    cache: false,\n    url: \"//surerussolutions.com/divegold-webservice/operation/add\",\n    type: \"POST\",\n    dataType: \"json\",\n    data: JSON.stringify(operation),\n    success: function(callback) {\n      console.log(callback);\n      dynatable.settings.dataset.originalRecords.push(callback);\n      dynatable.process();\n      sweetAlert('Operações salvas com sucesso!', '', 'success');\n    },\n    error: function() {\n      $.unblockUI();\n      configTimeout(\"Ocorreu um erro ao enviar ao salvar as operações.\");\n    }\n  });\n\n};\n\n$(document).ready(function() {\n  if (window.location.href.indexOf(\"/operacoes\") !== -1) {\n    initOperacoes();\n  }\n});\n"]}